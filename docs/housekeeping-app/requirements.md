# ハウスキーピングアプリ要件定義

## 1. 目的と背景
- 家の掃除・整頓タスクを可視化し、家族や個人が計画的に進められるようにする。
- 周期的な掃除や季節タスクを自動でリマインドし、抜け漏れを防止する。
- 生活動線や負荷に応じてタスクを最適化できるよう、部屋横断のグルーピングや優先度管理を行う。

## 2. 想定ユーザー
- 単身または家族で家事を管理したい一般ユーザー。
- 同居家族やハウスシェアメンバーとタスクを共有したいユーザー（明示的な招待がある場合のみ）。

## 3. 用語定義
- **ユーザー**: メールアドレスとパスワードで認証された個人。基本的には自身のデータのみ参照・編集可能。
- **部屋**: タスク管理単位となる空間（例: リビング、キッチン、ベランダ）。
- **掃除タスク**: 部屋に紐づく作業項目。周期・所要時間・優先度を持つ。
- **グループ**: 複数部屋に跨る掃除タスクの集合（例: 水回りセット、週末リセット）。
- **共有家族（オプション）**: 招待により特定の部屋やグループを共同で閲覧・編集できるメンバー。

## 4. 前提・制約
- 認証はメールアドレス + パスワード。将来的に SSO やパスワードレスに拡張できる構造とする。
- 権限モデル: デフォルトはユーザー専有データ。共有は明示的な招待・承諾がある場合のみで、権限は閲覧/編集を分離。
- モバイルブラウザ優先。レスポンシブ対応。
- 通知はプッシュ通知/メールを選択可能にし、ユーザー単位でオンオフ設定。

## 5. 機能要件
### 5.1 認証・アカウント
- メールアドレスとパスワードでアカウント登録・ログイン・ログアウトができる。
- パスワードリセット（メール送信リンク）。
- プロフィール編集（表示名、通知設定、タイムゾーン）。

### 5.2 部屋管理
- 部屋を登録/編集/アーカイブ/復元できる。
- 部屋一覧を取得し、名称順・最終掃除日時順でソート/フィルタできる。
- 部屋ごとにアイコンやカラーを設定し、視認性を高める。

### 5.3 掃除タスク管理
- 部屋に掃除タスクを登録/編集/削除できる。
- 各タスクに周期（毎日/毎週/毎月/カスタム日数）、優先度、想定所要時間、備考を設定できる。
- タスク完了のチェックイン履歴を保持し、次回予定日を自動計算する。
- タスクのスキップや延期を記録し、履歴に反映する。

### 5.4 グルーピング・横断表示
- 複数部屋に跨るタスクをグループ化できる（例: 「水回り掃除」「週末まとめ掃除」）。
- グループに含まれるタスク一覧を表示し、期日が近い順に並べ替えできる。
- グループ単位での完了率や今週の負荷（合計所要時間）を表示する。

### 5.5 表示・ダッシュボード
- 部屋一覧をカード形式/リスト形式で表示できる。
- 部屋ごとの掃除タスクを表示し、次回予定日が近い順に並べ替えできる。
- 今日/今週のタスクダッシュボードを提供し、優先度や所要時間でフィルタ可能。
- カレンダー表示でタスクの予定・履歴を俯瞰できる。

### 5.6 通知・リマインド
- 周期に基づき、予定日前日・当日にプッシュ通知/メールを送信できる。
- 通知静音（時間帯指定）と週次サマリー配信を設定できる。

### 5.7 共有・コラボレーション（オプション機能）
- 指定した部屋やグループに対して、メール招待による共同閲覧/編集権限を付与できる。
- 権限は閲覧のみ/編集可を分離し、いつでも解除できる。
- 共有メンバーの操作履歴（タスク完了/編集）をタイムラインで確認できる。

### 5.8 設定・カスタマイズ
- 周期のカスタムテンプレートを作成し、複数タスクで再利用できる。
- 優先度のラベル/カラーをユーザー定義できる。
- タスク完了時の写真添付を有効/無効で選択できる（保存容量上限を設定）。

## 6. 非機能要件
- **セキュリティ**: パスワードは安全なハッシュで保存。認可はユーザー/共有権限に基づき強制。通信は HTTPS 前提。
- **性能**: 一覧・ダッシュボード表示は 2 秒以内を目標。通知はトリガー後 1 分以内に送信開始。
- **信頼性**: 重要操作（招待、削除）は監査ログに記録。ソフトデリートで復元可能とする。
- **拡張性**: 周期計算や通知チャネルをプラガブルに設計し、新チャネル追加を容易にする。
- **可用性**: メンテナンス時は事前告知し、主要機能の代替手段（メール送信など）を用意する。

## 7. UX / アクセシビリティ
- モバイルファーストのレスポンシブ UI。主要操作は 3 タップ以内で到達可能に設計。
- 色覚多様性に配慮したカラーパレットとコントラスト比を採用。
- 音声読み上げへの対応（ARIA 属性付与）とキーボード操作で完結できるナビゲーション。

## 8. データ項目（例）
- ユーザー: id, email, password_hash, display_name, timezone, notification_settings, created_at, updated_at
- 部屋: id, user_id, name, icon, color, archived_at, created_at, updated_at
- 掃除タスク: id, room_id, title, description, cycle_type, custom_interval_days, priority, estimated_minutes, next_scheduled_at, last_completed_at, skip_count, created_at, updated_at
- タスク履歴: id, task_id, user_id, status (done/skipped/delayed), memo, attachment_url, completed_at, created_at
- グループ: id, user_id, name, color, description, created_at, updated_at
- グループタスク紐付け: group_id, task_id, order_index
- 招待/共有権限（オプション）: id, owner_user_id, target_user_id (または email), scope (room/group), role (viewer/editor), status, expires_at, created_at

## 9. バリデーション・エッジケース
- 部屋名/タスク名は必須、最大 100 文字。説明は 1,000 文字まで。
- 周期はプリセット（毎日/毎週/毎月）または 1〜365 日のカスタム日数を許容。
- 同一タスクの予定が過去にずれ込んだ場合でも履歴を保持し、次回予定を再計算。
- 共有招待は有効期限を設け、期限切れ時に自動無効化。

## 10. 開発上の考慮
- ドメイン層で部屋/タスク/グループ/通知を独立したサービスとして定義し、依存方向を内向きに保つ。
- 通知や周期計算はバッチ/ジョブキューを前提に抽象化し、後からワーカーを差し替え可能にする。
- API は GraphQL または REST を想定し、認可をミドルウェア層で一元管理する。
- バージョニング: 破壊的変更時はバージョンアップと移行ガイドを提供する。

## 11. 成功指標（例）
- 週次アクティブユーザー数の増加率。
- 通知クリック率、タスク完了率（予定対比）。
- タスク登録から完了までの平均リードタイム短縮。

## 12. リスクと対応
- 継続利用率が低下するリスク → プッシュ・メールによるリマインドと週次サマリーで定着を促す。
- 権限設定ミスによる情報漏洩 → デフォルト専有・明示的招待、権限表示のダブルチェック UI を設計。
- 過度の通知で離脱するリスク → 通知静音と頻度設定を用意し、初期値は控えめにする。

## 13. 今後の拡張案
- 音声アシスタント連携によるタスク登録/完了報告。
- 家電やセンサーとの連携による自動記録（例: 掃除機の稼働履歴）。
- ポイント/バッジによるゲーミフィケーションでモチベーションを維持。
