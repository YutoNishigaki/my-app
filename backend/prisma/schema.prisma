generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
  moduleFormat    = "cjs"
}

datasource db {
  provider = "sqlite"
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  role      Role     @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  rooms         Room[]
  cleaningTasks CleaningTask[]
  taskHistories TaskHistory[]
}

enum Role {
  USER
  ADMIN
}

model Room {
  id         String   @id @default(cuid())
  userId     String
  name       String
  icon       String?
  color      String?
  archivedAt DateTime?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  user          User           @relation(fields: [userId], references: [id])
  cleaningTasks CleaningTask[]
}

model CleaningTask {
  id                String     @id @default(cuid())
  roomId            String
  userId            String
  title             String
  description       String?
  cycleType         CycleType
  customIntervalDays Int?
  priority          Int?
  estimatedMinutes  Int?
  nextScheduledAt   DateTime?
  lastCompletedAt   DateTime?
  skipCount         Int        @default(0)
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt

  room     Room @relation(fields: [roomId], references: [id])
  user     User @relation(fields: [userId], references: [id])
  histories TaskHistory[]
}

model TaskHistory {
  id            String      @id @default(cuid())
  taskId        String
  userId        String
  status        TaskStatus
  memo          String?
  attachmentUrl String?
  completedAt   DateTime
  createdAt     DateTime    @default(now())

  task CleaningTask @relation(fields: [taskId], references: [id])
  user User         @relation(fields: [userId], references: [id])
}

enum CycleType {
  DAILY
  WEEKLY
  MONTHLY
  CUSTOM
}

enum TaskStatus {
  DONE
  SKIPPED
  DELAYED
}